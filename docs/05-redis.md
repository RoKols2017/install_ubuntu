# РЈСЃС‚Р°РЅРѕРІРєР° Redis

Redis РёСЃРїРѕР»СЊР·СѓРµС‚СЃСЏ РєР°Рє РєСЌС€ Рё РѕС‡РµСЂРµРґСЊ Р·Р°РґР°С‡ РґР»СЏ n8n.

## РџСЂРµРґРІР°СЂРёС‚РµР»СЊРЅС‹Рµ С‚СЂРµР±РѕРІР°РЅРёСЏ

- Docker СѓСЃС‚Р°РЅРѕРІР»РµРЅ ([Р­С‚Р°Рї 2](02-docker-installation.md))
- РџРѕСЂС‚: 6379

## РЁР°Рі 1: РЈСЃС‚Р°РЅРѕРІРєР° Redis

```bash
# РСЃРїРѕР»СЊР·СѓСЏ СЃРєСЂРёРїС‚ (СЂРµРєРѕРјРµРЅРґСѓРµС‚СЃСЏ)
sudo bash scripts/06-setup-redis.sh

# РР»Рё РІСЂСѓС‡РЅСѓСЋ С‡РµСЂРµР· РѕСЃРЅРѕРІРЅРѕР№ docker-compose.yml
cd docker-compose
docker compose up -d redis
```

## РЁР°Рі 2: РќР°СЃС‚СЂРѕР№РєР° РїР°СЂРѕР»СЏ Redis

РЎРєСЂРёРїС‚ Р°РІС‚РѕРјР°С‚РёС‡РµСЃРєРё РіРµРЅРµСЂРёСЂСѓРµС‚ РїР°СЂРѕР»СЊ Рё СЃРѕС…СЂР°РЅСЏРµС‚ РµРіРѕ РІ РѕСЃРЅРѕРІРЅРѕР№ `.env` С„Р°Р№Р» (`docker-compose/.env`).

Р•СЃР»Рё СѓСЃС‚Р°РЅР°РІР»РёРІР°РµС‚Рµ РІСЂСѓС‡РЅСѓСЋ, СѓР±РµРґРёС‚РµСЃСЊ, С‡С‚Рѕ РІ С„Р°Р№Р»Рµ `docker-compose/.env` РµСЃС‚СЊ РїРµСЂРµРјРµРЅРЅР°СЏ:

```bash
REDIS_PASSWORD=your-secure-redis-password
```

**Р’Р°Р¶РЅРѕ:** РЎРѕС…СЂР°РЅРёС‚Рµ СЌС‚РѕС‚ РїР°СЂРѕР»СЊ! РћРЅ РїРѕРЅР°РґРѕР±РёС‚СЃСЏ РґР»СЏ РЅР°СЃС‚СЂРѕР№РєРё n8n.

## РЁР°Рі 3: РџСЂРѕРІРµСЂРєР° СЂР°Р±РѕС‚С‹

```bash
# РџРѕРґРєР»СЋС‡РµРЅРёРµ Рє Redis
docker exec -it redis redis-cli -a your-redis-password

# Р’ Redis CLI:
PING  # Р”РѕР»Р¶РЅРѕ РІРµСЂРЅСѓС‚СЊ PONG
INFO  # РРЅС„РѕСЂРјР°С†РёСЏ Рѕ СЃРµСЂРІРµСЂРµ
EXIT  # Р’С‹С…РѕРґ
```

РР»Рё С‡РµСЂРµР· СЃРєСЂРёРїС‚:

```bash
docker exec redis redis-cli -a YOUR_PASSWORD ping
```

## РљРѕРЅС„РёРіСѓСЂР°С†РёСЏ

### РќР°СЃС‚СЂРѕР№РєР° РїРµСЂСЃРёСЃС‚РµРЅС‚РЅРѕСЃС‚Рё

Redis РЅР°СЃС‚СЂРѕРµРЅ РЅР° AOF (Append Only File) РґР»СЏ РїРµСЂСЃРёСЃС‚РµРЅС‚РЅРѕСЃС‚Рё РґР°РЅРЅС‹С…. Р­С‚Рѕ РѕР·РЅР°С‡Р°РµС‚, С‡С‚Рѕ РІСЃРµ РѕРїРµСЂР°С†РёРё Р·Р°РїРёСЃС‹РІР°СЋС‚СЃСЏ РІ С„Р°Р№Р» Рё РІРѕСЃСЃС‚Р°РЅР°РІР»РёРІР°СЋС‚СЃСЏ РїСЂРё РїРµСЂРµР·Р°РїСѓСЃРєРµ.

### РќР°СЃС‚СЂРѕР№РєР° РїР°РјСЏС‚Рё

РџРѕ СѓРјРѕР»С‡Р°РЅРёСЋ СѓСЃС‚Р°РЅРѕРІР»РµРЅ Р»РёРјРёС‚ 512 MB. Р”Р»СЏ РёР·РјРµРЅРµРЅРёСЏ РѕС‚СЂРµРґР°РєС‚РёСЂСѓР№С‚Рµ РѕСЃРЅРѕРІРЅРѕР№ `docker-compose/docker-compose.yml`:

```yaml
command: redis-server --requirepass ${REDIS_PASSWORD} --appendonly yes --maxmemory 1gb --maxmemory-policy allkeys-lru
```

### РџРѕР»РёС‚РёРєРё eviction

- `allkeys-lru` - СѓРґР°Р»СЏРµС‚ РЅР°РёРјРµРЅРµРµ РёСЃРїРѕР»СЊР·СѓРµРјС‹Рµ РєР»СЋС‡Рё РїСЂРё РґРѕСЃС‚РёР¶РµРЅРёРё Р»РёРјРёС‚Р° РїР°РјСЏС‚Рё
- Р”СЂСѓРіРёРµ РІР°СЂРёР°РЅС‚С‹: `volatile-lru`, `allkeys-random`, `noeviction`

## РСЃРїРѕР»СЊР·РѕРІР°РЅРёРµ СЃ n8n

Redis РёСЃРїРѕР»СЊР·СѓРµС‚СЃСЏ n8n РґР»СЏ:
- РћС‡РµСЂРµРґРµР№ Р·Р°РґР°С‡ (Bull queues)
- РљСЌС€РёСЂРѕРІР°РЅРёСЏ СЂРµР·СѓР»СЊС‚Р°С‚РѕРІ
- Pub/Sub РґР»СЏ real-time РєРѕРјРјСѓРЅРёРєР°С†РёРё

РќР°СЃС‚СЂРѕР№С‚Рµ РІ n8n С‡РµСЂРµР· РїРµСЂРµРјРµРЅРЅС‹Рµ РѕРєСЂСѓР¶РµРЅРёСЏ:
- `QUEUE_BULL_REDIS_HOST=redis`
- `QUEUE_BULL_REDIS_PORT=6379`
- `QUEUE_BULL_REDIS_PASSWORD=your-redis-password`

## РњРѕРЅРёС‚РѕСЂРёРЅРі

```bash
# РРЅС„РѕСЂРјР°С†РёСЏ Рѕ СЃРµСЂРІРµСЂРµ
docker exec redis redis-cli -a YOUR_PASSWORD INFO server

# РЎС‚Р°С‚РёСЃС‚РёРєР° РїР°РјСЏС‚Рё
docker exec redis redis-cli -a YOUR_PASSWORD INFO memory

# РљРѕР»РёС‡РµСЃС‚РІРѕ РєР»СЋС‡РµР№
docker exec redis redis-cli -a YOUR_PASSWORD DBSIZE

# РЎРїРёСЃРѕРє РІСЃРµС… РєР»СЋС‡РµР№ (РѕСЃС‚РѕСЂРѕР¶РЅРѕ РЅР° production!)
docker exec redis redis-cli -a YOUR_PASSWORD KEYS "*"
```

## Р РµР·РµСЂРІРЅРѕРµ РєРѕРїРёСЂРѕРІР°РЅРёРµ

```bash
# РЎРѕР·РґР°РЅРёРµ RDB СЃРЅРёРјРєР°
docker exec redis redis-cli -a YOUR_PASSWORD --rdb /data/dump.rdb

# РљРѕРїРёСЂРѕРІР°РЅРёРµ С„Р°Р№Р»Р° AOF
docker cp redis:/data/appendonly.aof ./backup/
```

## РЈСЃС‚СЂР°РЅРµРЅРёРµ РЅРµРїРѕР»Р°РґРѕРє

### РџСЂРѕР±Р»РµРјР°: Redis РЅРµ Р·Р°РїСѓСЃРєР°РµС‚СЃСЏ

```bash
# РџСЂРѕРІРµСЂСЊС‚Рµ Р»РѕРіРё
docker logs redis

# РџСЂРѕРІРµСЂСЊС‚Рµ РїРѕСЂС‚
sudo netstat -tlnp | grep 6379
```

### РџСЂРѕР±Р»РµРјР°: РћС€РёР±РєР° Р°СѓС‚РµРЅС‚РёС„РёРєР°С†РёРё

```bash
# РџСЂРѕРІРµСЂСЊС‚Рµ РїР°СЂРѕР»СЊ РІ .env С„Р°Р№Р»Рµ
# РЈР±РµРґРёС‚РµСЃСЊ, С‡С‚Рѕ РёСЃРїРѕР»СЊР·СѓРµС‚Рµ РїСЂР°РІРёР»СЊРЅС‹Р№ РїР°СЂРѕР»СЊ РїСЂРё РїРѕРґРєР»СЋС‡РµРЅРёРё
```

### РџСЂРѕР±Р»РµРјР°: РќРµС…РІР°С‚РєР° РїР°РјСЏС‚Рё

```bash
# РџСЂРѕРІРµСЂСЊС‚Рµ РёСЃРїРѕР»СЊР·РѕРІР°РЅРёРµ РїР°РјСЏС‚Рё
docker exec redis redis-cli -a YOUR_PASSWORD INFO memory

# РЈРІРµР»РёС‡СЊС‚Рµ Р»РёРјРёС‚ РІ docker-compose.yml РёР»Рё РѕС‡РёСЃС‚РёС‚Рµ СЃС‚Р°СЂС‹Рµ РєР»СЋС‡Рё
docker exec redis redis-cli -a YOUR_PASSWORD FLUSHDB  # РћРЎРўРћР РћР–РќРћ!
```

## РћРїС‚РёРјРёР·Р°С†РёСЏ РїСЂРѕРёР·РІРѕРґРёС‚РµР»СЊРЅРѕСЃС‚Рё

### РќР°СЃС‚СЂРѕР№РєР° РґР»СЏ production

1. **РћС‚РєР»СЋС‡РёС‚Рµ РїРµСЂСЃРёСЃС‚РµРЅС‚РЅРѕСЃС‚СЊ** (РµСЃР»Рё РґР°РЅРЅС‹Рµ РЅРµ РєСЂРёС‚РёС‡РЅС‹):
   ```yaml
   command: redis-server --requirepass ${REDIS_PASSWORD} --maxmemory 1gb
   ```

2. **РСЃРїРѕР»СЊР·СѓР№С‚Рµ СЂРµРїР»РёРєР°С†РёСЋ** РґР»СЏ РІС‹СЃРѕРєРѕР№ РґРѕСЃС‚СѓРїРЅРѕСЃС‚Рё

3. **РќР°СЃС‚СЂРѕР№С‚Рµ РјРѕРЅРёС‚РѕСЂРёРЅРі** С‡РµСЂРµР· Redis INFO РєРѕРјР°РЅРґС‹

## РЎР»РµРґСѓСЋС‰РёРµ С€Р°РіРё

РџРѕСЃР»Рµ СѓСЃС‚Р°РЅРѕРІРєРё Redis:
1. РЈСЃС‚Р°РЅРѕРІРёС‚Рµ n8n: [04-n8n.md](04-n8n.md)

## РСЃС‚РѕС‡РЅРёРєРё

- [РћС„РёС†РёР°Р»СЊРЅР°СЏ РґРѕРєСѓРјРµРЅС‚Р°С†РёСЏ Redis](https://redis.io/docs/)
- [Redis Best Practices](https://redis.io/docs/manual/patterns/)

